var displayArea = document.querySelector('.conversation-display');

// code to set messages to read when oping conversartion

<% @conversation.messages.where(user_id: @conversation.opposed_user(current_user).id).each do |message| %>
<% message.read = true %>
<% message.save %>
<% end %>

displayArea.innerHTML = '<%= j render "conversations/conversation", conversation: @conversation %>'
displayArea.insertAdjacentHTML('beforeEnd', '<%= j render "conversations/submit", conversation: @conversation %>')

displayArea.scrollTop = displayArea.scrollHeight;

document.addEventListener('click', (event) => {
  var receivedMessages = [];
  document.querySelectorAll('.bubble-left').forEach((message) => {
    receivedMessages.push(message.dataset.messageId)
  })
  console.log(receivedMessages)
  var message_array = {
  ids: receivedMessages
}

// Post data via ajax to rails controller
$.post('/message/update', message_array);
})

function submitOnEnter(event){
    if(event.which === 13 && !event.shiftKey){
        elem = event.target.form
        Rails.fire(elem, 'submit');
        event.preventDefault();
    }
}

document.querySelector(".typing-area").addEventListener("keypress", submitOnEnter);
